# 4️⃣ 데드락 Deadlock
<br>

## 🔁 데드락이란?

![image](https://github.com/user-attachments/assets/60e0c694-3f44-4187-ab1f-d165b2734bf4)

- aka 교착상태
- 시스템 자원에 대한 요구가 뒤엉킨 상태
- **둘 이상의 프로세스가 다른 프로세스가 점유하고 있는 자원을 서로 기다릴 때 무한 대기에 빠지는 상황**
- 시스템적으로 한정된 자원을 여러 곳에서 사용하려고 할 때 발생한다
- 다중 프로그래밍 환경에서 흔히 발생할 수 있는 문제
<br>

---
<br>

## 🤷🏻 데드락 발생 조건

### 🔸 1. 상호 배제 (Mutal Exclusion)

- 한 번에 하나의 프로세스만 해당 자원을 이용할 수 있다
- 한 프로세스가 사용하는 자원을 다른 프로세스가 사용할 수 없는 상황
<br>

### 🔸 2. 점유 대기 (Hold and Wait)

- **[점유]** 한 프로세스가 어떤 자원을 점유하고 있으면서
- **[대기]** 다른 자원의 할당을 기다린다면 교착상태 발생 가능
<br>

### 🔸 3. 비선점 (Non-preemption)

- 어떤 프로세스도 다른 프로세스의 자원을 강제로 뺏지 못하는 경우
<br>

### 🔸 4. 순환 구조 (Circular Wait)

- 각각의 프로세스가 서로 점유한 자원을 할당받기 위해 원의 형태로 대기할 경우
![image](https://github.com/user-attachments/assets/b4480f46-4521-4662-89d9-7f3ce257ff39)
<br>

### **✅ 상호배제 + 점유대기 + 비선점 + 순환구조 ⇒ 데드락**

- 4가지 조건이 모두 성립해야 데드락 발생
- 하나라도 성립하지 않으면 데드락이 발생하지 않는다!
<br>

---
<br>

## 🛠️ 해결 방법

- 교착상태 예방
- 교착상태 회피
- 교착상태 탐지 후 복구
<br>

---
<br>

## 💉 교착상태 예방 (Prevention)

- **교착 상태를 발생시키는 4가지 필요 조건 중 하나를 충족하지 못하게 하는 방법**
<br>

### 🔹 **1. 상호배제 조건 방지**

- 한 번에 여러 프로세스가 공유 자원을 사용
- 그러나 동기화 관련 문제가 발생할 수 있음
<br>

### 🔹 **2. 점유대기 조건 방지**

- 프로세스 실행에 필요한 모든 자원을 한 번에 할당
<br>

### 🔹 **3. 비선점 조건 방지**

- 이미 할당된 자원을 프로세스가 사용 중일 때 다른 프로세스의 요청에 의해 강제로 회수 가능
- 우선순위가 높은 프로세스가 자원을 요청하면, 우선순위가 낮은 프로세스로부터 자원 선점
- 우선순위 관리가 필요
<br>

### 🔹 **4. 순환구조 조건 방지**

- 자원에 번호를 매기고 프로세스들이 오름차순/내림차순으로 자원을 할당받도록 제한하기
- 순환구조 x 선형구조 o

- 각 방법은 특정 상황에서 유용할 수 있으나, 시스템의 성능이나 자원 활용도에 영향을 줄 수 있다
- 운영체제에서 예방 방법을 실제로 도입하는 것은 복잡하며, 다소 비현실적이다
<br>

---
<br>

## 🥑 교착상태 회피 (Avoidance)

- **교착 상태가 발생하지 않게 피하면서 자원을 할당하는 방법**
<br>

### 🪙 **1. 은행원 알고리즘 (Banker’s algorithm)**

- 다익스트라가 제안한 기법으로, 모든 고객의 요구가 충족되도록 현금을 할당하는데서 유래
- 프로세스가 자원을 요구할 때, 자원을 할당한 후에도 안전상태로 남아있는지 검사
    - 안전상태 : 교착상태가 발생하지 않으며 모든 프로세스가 완료될 수 있는 상태
    - 불안전상태 : 교착상태가 발생할 수 있는 상태
- 안전 상태면 자원을 할당하고, 아니면 대기
- 은행원 알고리즘을 적용하기 위해서는 자원의 양과 프로세스 수가 일정해야 한다
<br>

### 🛟 **2. 자원 할당 그래프 알고리즘**

- 자원과 프로세스에 대해 요청 간선과 할당 간선을 적용하여 교착 상태를 회피하는 알고리즘
- 프로세스가 자원을 요구하면 해당 요청 간선을 할당 간선으로 변경해도 사이클이 생성되지 않을 때만 요청 허용
    - 사이클이 없다면 자원을 할당해도 시스템은 안전 상태 유지
- 사이클이 생성된다 하여 무조건 교착상태인 것은 아니다
    - 자원에 하나의 인스턴스만 존재하면 교착 상태 판별
    - 자원에 여러 인스턴스가 존재하면 교착 상태 가능성으로 판별
- 사이클을 생성하지 않으면 자원을 할당
<br>

### ✅ 장단점

- **장점** : 자원의 사용률을 높일 수 있다
- **단점**
    - 프로세스의 최대 자원 요구량을 미리 알아야 하며, 항상 가능하지는 않을 수 있다
    - 시스템의 자원 할당 상태를 지속적으로 모니터링 해야 하므로 오버헤드가 발생할 수 있다
<br>

---
<br>

## 🔧 교착상태 탐지 후 회복 (Detection & Recovery)

- **교착 상태의 발생을 허용한 다음 회복시키는 방법**
<br>

### 🔍 **탐지**

- 주기적으로 교착 상태의 발생 여부를 검사
- **자원 할당 그래프**를 통해 교착 상태 탐지
- 지속적으로 관리해야 하므로 추가적인 오버헤드 발생
<br>

### ❤️‍🩹 **회복**

1. **자원 선점**
    - 교착 상태의 프로세스가 점유하고 있는 자원을 선점해 다른 프로세스에게 할당
    - 우선 순위가 낮은 프로세스, 수행 횟수가 적은 프로세스 위주로 자원 선점
    - 자원 선점 과정에서 프로세스의 상태를 안전하게 복구할 수 있는 방법 필요
2. **프로세스 종료**
    - 교착 상태의 프로세스를 강제 종료
    - 교착 상태인 모든 프로세스 종료하는 방법, 교착 상태가 제거될 때까지 하나씩 프로세스 중지하는 방법 등
    - 비용이 높은 방법일 수 있으며, 작업의 손실이 발생할 수 있다
