# 5️⃣ 시스템 콜 (System Call)

## ⚙️ 커널 영역과 사용자 영역

![image](https://github.com/user-attachments/assets/2ba50ff3-e60d-498c-8321-be2b33fe8018)

### 운영체제

- **커널 영역에 적재**
- 운영체제도 일종의 프로그램이므로 실행을 위해 반드시 메모리에 적재되어야 한다
- 다양한 서비스들을 수행하기 위해 하드웨어를 직접적으로 관리
    - 프로세스 관리, 메모리 관리, 저장장치 관리 등

### 응용프로그램

- **사용자 영역에 적재**
- 운영체제와 달리 CPU, 메모리와 같은 자원에 직접 접근 불가
- 운영체제의 기능을 제공받기 위해서는 커널영역에 적재된 운영체제 코드를 실행해야 한다

---

## ⚡ 시스템 콜

![image](https://github.com/user-attachments/assets/b3a4cc9f-b6dc-4d5e-93fb-3c1beea18b09)

- **응용 프로그램이 운영체제가 제공하는 서비스를 사용하기 위한 인터페이스**
- 어떤 기능을 제공받고자 한다면, 그 기능에 해당하는 시스템 콜을 호출
- 일반 애플리케이션은 오직 시스템 콜을 통해서만 하드웨어나 시스템 자원에 접근 가능
    
    **→ 운영체제의 보안과 안정성 유지**
    
- 일반적으로 직접 시스템 콜을 사용하기보다 API를 통해 사용 ex) JAVA API, standard C Library

---

## 🔄 시스템 콜의 호출과 2가지 모드

![image](https://github.com/user-attachments/assets/5a04201a-f15a-4fbd-8426-74318e022800)

### 커널 모드

: 커널 영역의 코드를 실행할 때의 모드

- 운영체제가 CPU를 사용하는 모드
- 운영체제 서비스를 제공받을 수 있는 실행 모드

### 사용자 모드

: 사용자 영역의 코드 (응용프로그램)을 실행할 때의 모드

- 운영체제 서비스를 제공받을 수 있는 실행 모드

### 동작 흐름

![image](https://github.com/user-attachments/assets/6cda987e-4b3b-4d56-8927-fec0df9d73ae)

- **mode bit** : 사용자 모드와 커널 모드를 구분

### 동작 예시

![image](https://github.com/user-attachments/assets/9a3225be-8eca-4467-b234-9d901f9b9c7c)

1. 응용 프로그램에서 API 호출
    - 내부적으로 적절한 시스템 콜 호출
2. 사용자 모드 → 커널 모드
    - 보통 인터럽트나 트랩을 이용하여 이루어짐
        - 인터럽트 : 비동기적 CPU 이벤트를 처리하기 위한 기법 ex) 네트워크 패킷 도착 이벤트, I/O 요청
        - 트랩 : 동기적 CPU 이벤트를 처리하기 위한 기법 ex) divide by zero
    - 커널은 내부적으로 시스템 콜을 분류하기 위해 기능별로 고유번호를 할당하고 그 번호에 해당하는 제어 루틴을 정의
3. 커널 코드 실행
    - 대응하는 고유번호를 확인하고 번호에 맞는 코드 실행
4. 결과 반환
    - 응용 프로그램으로 결과를 반환
    - 커널 모드 → 사용자 모드

---

## 🛠️ 시스템 콜의 종류

### 1. 프로세스 컨트롤

- fork : 새 자식 프로세스 생성
- execve : 프로세스 실행
- exit : 프로세스 종료
- waitpid : 자식 프로세스 종료까지 대기
- 이벤트 발생 시 알림 (signal event)

### 2. 파일 관리

- open : 파일 열기
- close : 파일 닫기
- read : 파일 읽기
- write : 파일 쓰기
- 파일 속성 획득 및 설정

### 3. 디바이스 관리

- 하드웨어의 제어와 상태 정보 얻기 (ioctl)
- 디바이스 요청 및 해제
- 읽기, 쓰기, 위치 변경
- 디바이스 속성 확인, 지정

### 4. 정보 관리

- 시간 확인, 시간 지정
- 시스템 데이터 확인, 지정

### 5. 통신

- pipe() : 프로세스 간 통신
- 커뮤니케이션 연결 생성 및 삭제
- 메시지 송수신
- 상태 정보 전달

### 6. 보호

- chmod() : 권한을 변경하는 명령어
- umask() : 새로 생성되는 파일, 디렉토리의 권한을 제한
- chown() : 소유권을 변경하는 명령어

